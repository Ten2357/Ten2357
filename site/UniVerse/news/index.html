<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Static News Portal</title>
  <link rel="stylesheet" href="https://pandao.github.io/editor.md/css/editormd.css" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background:#0d0d0d; color:#e6e6e6; margin:0; padding:0; }
    header { background:#1a1a1a; padding:1rem; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.5); }
    header h1 { margin:0; font-weight:600; }
    .controls { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; padding:1rem; background:#111; position:sticky; top:0; z-index:10; }
    input, select { padding:0.6rem; border-radius:8px; border:none; background:#222; color:#eee; }
    input:focus, select:focus { outline:2px solid #444; }
    .news-list { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:1.2rem; padding:1.5rem; }
    .news-card { background:#1a1a1a; border-radius:12px; overflow:hidden; cursor:pointer; transition:transform 0.2s, box-shadow 0.2s; box-shadow:0 4px 8px rgba(0,0,0,0.4); }
    .news-card:hover { transform:translateY(-5px); box-shadow:0 8px 16px rgba(0,0,0,0.6); }
    .news-card img { width:100%; height:180px; object-fit:cover; }
    .news-card .content { padding:0.8rem; }
    .news-card h3 { margin:0; font-size:1.1rem; font-weight:600; }
    .news-card small { color:#aaa; }
    .star { color: gold; font-size:1.2rem; margin-left:6px; }
    .viewer { display:none; padding:2rem; max-width:900px; margin:auto; }
    .viewer.active { display:block; }
    button.back { margin:1rem 0; padding:0.6rem 1.2rem; border:none; border-radius:6px; background:#333; color:white; cursor:pointer; transition:background 0.2s; }
    button.back:hover { background:#444; }
  </style>
</head>
<body>
  <header>
    <h1>üì∞ Static News</h1>
  </header>

  <div class="controls">
    <input type="text" id="search" placeholder="Search news...">
    <select id="dateFilter">
      <option value="all">All Dates</option>
      <option value="latest">Latest</option>
      <option value="oldest">Oldest</option>
    </select>
    <select id="starFilter">
      <option value="all">All</option>
      <option value="star">‚≠ê Starred Only</option>
      <option value="anti">üö´ Anti-Star</option>
    </select>
  </div>

  <div class="controls" id="buttons">
    <!-- Manually add buttons -->
    <button onclick="openNews('example')">Example News</button>
    <button onclick="openNews('update')">Big Update</button>
  </div>

  <div id="newsList" class="news-list"></div>

  <div id="viewer" class="viewer">
    <button class="back" onclick="goBack()">‚¨Ö Back</button>
    <div id="newsContent"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://pandao.github.io/editor.md/editormd.min.js"></script>
  <script>
    let newsData = [];

    async function openNews(id) {
      try {
        const res = await fetch(`/stuff/${id}.json`);
        if (!res.ok) throw new Error("News not found on server");
        const news = await res.json();
        newsData = [news];

        newsList.style.display = 'none';
        viewer.classList.add('active');

        // Render Markdown directly from JSON
        newsContent.innerHTML = `<div id="md-view"><textarea style='display:none;'>${news.md}</textarea></div>`;
        editormd.markdownToHTML("md-view", {
          markdown: news.md,
          path: "https://pandao.github.io/editor.md/lib/"
        });
      } catch(e) {
        console.error(e);
        newsContent.innerHTML = `<p>‚ùå Could not load news: ${id}</p>`;
      }
    }

    function goBack() {
      viewer.classList.remove('active');
      newsList.style.display = 'grid';
    }

    const newsList = document.getElementById('newsList');
    const searchInput = document.getElementById('search');
    const dateFilter = document.getElementById('dateFilter');
    const starFilter = document.getElementById('starFilter');

    function renderNewsList() {
      newsList.innerHTML = '';
      if (!newsData || newsData.length === 0) return;

      const search = searchInput.value.toLowerCase();
      const dateMode = dateFilter.value;
      const starMode = starFilter.value;

      let filtered = newsData.filter(n => {
        const matchesSearch = !search || n.title.toLowerCase().includes(search);
        const matchesStar = (starMode === 'all') || (starMode === 'star' && n.star) || (starMode === 'anti' && !n.star);
        return matchesSearch && matchesStar;
      });

      if (dateMode === 'latest') filtered.sort((a,b) => new Date(b.date) - new Date(a.date));
      if (dateMode === 'oldest') filtered.sort((a,b) => new Date(a.date) - new Date(b.date));

      filtered.forEach(n => {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.innerHTML = `
          <img src="${n.image}" alt="${n.title}">
          <div class="content">
            <h3>${n.title} ${n.star ? '<span class="star">‚≠ê</span>' : ''}</h3>
            <small>${n.date}</small>
          </div>`;
        card.onclick = () => openNews(n.id);
        newsList.appendChild(card);
      });
    }

    searchInput.addEventListener('input', renderNewsList);
    dateFilter.addEventListener('change', renderNewsList);
    starFilter.addEventListener('change', renderNewsList);

    const params = new URLSearchParams(location.search);
    if (params.has('news')) openNews(params.get('news'));
  </script>
</body>
</html>
