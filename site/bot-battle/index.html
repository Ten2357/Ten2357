const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let bullets = [];
let lastShotTime = 0;
const shootCooldown = 300;

const player = {
  x: 400,
  y: 300,
  size: 20,
  weapon: "gun"
};

const weaponData = {
  gun: { speed: 7, damage: 10 }
};

canvas.addEventListener("click", (e) => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  shootTowards(mouseX, mouseY);
});

function shootTowards(targetX, targetY) {
  const now = Date.now();
  if (now - lastShotTime < shootCooldown) return;

  const w = weaponData[player.weapon];
  const startX = player.x + player.size / 2;
  const startY = player.y + player.size / 2;
  let dx = targetX - startX;
  let dy = targetY - startY;
  const dist = Math.hypot(dx, dy);
  if (dist === 0) return;
  dx = (dx / dist) * w.speed;
  dy = (dy / dist) * w.speed;

  bullets.push({
    x: startX,
    y: startY,
    dx,
    dy,
    size: 5,
    color: "yellow",
    damage: w.damage
  });

  lastShotTime = now;
}

function updateBullets() {
  bullets.forEach(b => {
    b.x += b.dx;
    b.y += b.dy;
  });
  bullets = bullets.filter(b => b.x >= 0 && b.x <= 800 && b.y >= 0 && b.y <= 600);
}

function draw() {
  ctx.clearRect(0, 0, 800, 600);
  // draw player
  ctx.fillStyle = "lime";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // draw bullets
  bullets.forEach(b => {
    ctx.fillStyle = b.color;
    ctx.fillRect(b.x, b.y, b.size, b.size);
  });
}

function gameLoop() {
  updateBullets();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
