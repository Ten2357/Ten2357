<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2D Bot Battle Game</title>
<style>
  * {
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  body, html {
    margin: 0; padding: 0; height: 100vh; background: #000; color: #eee;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
  }
  #gameCanvas {
    background: #111;
    border: 2px solid #333;
    display: block;
    margin-top: 10px;
  }
  #ui {
    margin-top: 10px;
    display: flex;
    gap: 20px;
    font-size: 18px;
  }
  #shopToggle {
    margin-top: 10px;
    padding: 8px 16px;
    background: #222;
    border: 1px solid #444;
    color: #eee;
    cursor: pointer;
    border-radius: 4px;
  }
  #shopToggle:hover {
    background: #333;
  }
  #shop {
    background: #111;
    border: 2px solid #444;
    color: #eee;
    padding: 15px;
    margin-top: 10px;
    width: 320px;
    display: none;
    border-radius: 6px;
  }
  #shop h2 {
    margin-top: 0;
    text-align: center;
    margin-bottom: 12px;
  }
  .shop-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .shop-item button {
    background: #222;
    border: 1px solid #444;
    color: #eee;
    padding: 5px 12px;
    cursor: pointer;
    border-radius: 4px;
  }
  .shop-item button:hover {
    background: #333;
  }
</style>
</head>
<body>
  <canvas id="gameCanvas" width="700" height="450"></canvas>

  <div id="ui">
    <div id="scoreBoard">Score: 0</div>
    <div id="healthBar">Health: 100</div>
    <div id="ammoCount">Ammo: ∞</div>
  </div>

  <button id="shopToggle">Open Shop</button>

  <div id="shop">
    <h2>Shop</h2>
    <div class="shop-item">
      <span>Rocket Launcher (1 rocket) - 10 points</span>
      <button data-item="rocketLauncher">Buy</button>
    </div>
    <div class="shop-item">
      <span>Bomb - 5 points</span>
      <button data-item="bomb">Buy</button>
    </div>
    <div class="shop-item">
      <span>Mine - 5 points</span>
      <button data-item="mine">Buy</button>
    </div>
    <div class="shop-item">
      <span>Shield (lasts 10 hits) - 15 points</span>
      <button data-item="shield">Buy</button>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const scoreBoard = document.getElementById('scoreBoard');
  const healthBar = document.getElementById('healthBar');
  const ammoCount = document.getElementById('ammoCount');
  const shopToggle = document.getElementById('shopToggle');
  const shop = document.getElementById('shop');
  const shopButtons = shop.querySelectorAll('button[data-item]');

  const PLAYER_SIZE = 30;
  const BOT_SIZE = 30;
  const BULLET_RADIUS = 5;
  const MAX_BOTS = 10;

  let keys = {};
  let mouse = {x: canvas.width / 2, y: canvas.height / 2};
  let firingInterval = null;

  // Player object
  let player = {
    x: canvas.width / 2,
    y: canvas.height - 60,
    health: 100,
    score: 0,
    weapon: 'gun', // 'gun' or 'rocket'
    rocketsAvailable: 0,
    bombs: 0,
    mines: 0,
    shield: false,
    shieldHitsLeft: 0,
    width: PLAYER_SIZE,
    height: PLAYER_SIZE,
    ammo: Infinity,
  };

  // Arrays for game objects
  let bullets = [];
  let bots = [];
  let minesPlaced = [];
  let bombsPlaced = [];

  // Load score from localStorage
  let storedScore = parseInt(localStorage.getItem('score'));
  if (!isNaN(storedScore)) player.score = storedScore;

  // Update UI text function
  function updateUI() {
    scoreBoard.textContent = 'Score: ' + player.score;
    healthBar.textContent = 'Health: ' + player.health;
    if (player.shield) {
      ammoCount.textContent = `Ammo: ${player.weapon === 'gun' ? '∞' : player.rocketsAvailable} | Shield: ${player.shieldHitsLeft} hits left`;
    } else {
      ammoCount.textContent = `Ammo: ${player.weapon === 'gun' ? '∞' : player.rocketsAvailable}`;
    }
  }

  // Rectangular collision helper
  function rectCollision(a, b) {
    return (
      a.x < b.x + b.width &&
      a.x + a.width > b.x &&
      a.y < b.y + b.height &&
      a.y + a.height > b.y
    );
  }

  // Spawn a bot at random x at top with random speed
  function spawnBot() {
    if (bots.length >= MAX_BOTS) return;
    bots.push({
      x: Math.random() * (canvas.width - BOT_SIZE),
      y: -BOT_SIZE,
      width: BOT_SIZE,
      height: BOT_SIZE,
      health: 100,
      speed: 1 + Math.random() * 1.5,
    });
  }

  // Player shoots bullet or rocket
  function shoot() {
    if (player.weapon === 'rocket') {
      if (player.rocketsAvailable <= 0) return; // no rocket ammo
      player.rocketsAvailable--;
      bullets.push(createBullet('rocket'));
      player.weapon = 'gun'; // revert to gun after rocket use
      updateUI();
      return;
    }
    // Gun has infinite ammo
    bullets.push(createBullet('gun'));
  }

  function createBullet(type) {
    let angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    return {
      x: player.x + player.width/2,
      y: player.y + player.height/2,
      dx: Math.cos(angle) * 7,
      dy: Math.sin(angle) * 7,
      radius: BULLET_RADIUS,
      type: type
    };
  }

  // Update game state each frame
  function update() {
    // Move player with WASD/arrows
    if (keys['w'] || keys['arrowup']) player.y -= 5;
    if (keys['s'] || keys['arrowdown']) player.y += 5;
    if (keys['a'] || keys['arrowleft']) player.x -= 5;
    if (keys['d'] || keys['arrowright']) player.x += 5;

    // Keep player inside canvas bounds
    player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
    player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));

    // Update bullets position and check collisions
    for (let i = bullets.length -1; i >= 0; i--) {
      let b = bullets[i];
      b.x += b.dx;
      b.y += b.dy;

      // Remove bullets out of canvas
      if (b.x < -10 || b.x > canvas.width + 10 || b.y < -10 || b.y > canvas.height + 10) {
        bullets.splice(i, 1);
        continue;
      }

      // Check bot hits
      for (let j = bots.length -1; j >= 0; j--) {
        let bot = bots[j];
        let distX = bot.x + bot.width/2 - b.x;
        let distY = bot.y + bot.height/2 - b.y;
        let dist = Math.sqrt(distX*distX + distY*distY);
        if (dist < bot.width/2 + b.radius) {
          // Damage bot
          bot.health -= (b.type === 'rocket' ? 100 : 25);
          bullets.splice(i, 1);
          if (bot.health <= 0) {
            bots.splice(j, 1);
            player.score++;
            localStorage.setItem('score', player.score);
            updateUI();
          }
          break;
        }
      }
    }

    // Update bots position and check collision with player or mines
    for (let i = bots.length -1; i >= 0; i--) {
      let bot = bots[i];
      // Move downwards and slowly move horizontally towards player
      bot.y += bot.speed;
      if (bot.x + bot.width/2 < player.x + player.width/2) bot.x += 0.5;
      else if (bot.x + bot.width/2 > player.x + player.width/2) bot.x -= 0.5;

      // Check collision with player
      if (rectCollision(bot, player)) {
        if (player.shield) {
          player.shieldHitsLeft--;
          if (player.shieldHitsLeft <= 0) player.shield = false;
        } else {
          player.health -= 1;
          if (player.health <= 0) {
            respawn();
          }
        }
        bots.splice(i, 1);
        continue;
      }

      // Check collision with mines
      for (let m = minesPlaced.length -1; m >= 0; m--) {
        let mine = minesPlaced[m];
        if (rectCollision(bot, mine)) {
          bots.splice(i, 1);
          minesPlaced.splice(m, 1);
          player.score++;
          localStorage.setItem('score', player.score);
          updateUI();
          break;
        }
      }

      // Remove bots that go out of bottom screen
      if (bot.y > canvas.height) bots.splice(i, 1);
    }
  }

  // Respawn player and reset bots
  function respawn() {
    player.health = 100;
    player.shield = false;
    player.shieldHitsLeft = 0;
    player.weapon = 'gun';
    player.rocketsAvailable = 0;
    bots = [];
    updateUI();
  }

  // Drawing everything
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw player
    ctx.fillStyle = player.shield ? 'cyan' : 'lime';
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Draw bots
    bots.forEach(bot => {
      ctx.fillStyle = 'red';
      ctx.fillRect(bot.x, bot.y, bot.width, bot.height);
    });

    // Draw bullets
    bullets.forEach(b => {
      ctx.fillStyle = b.type === 'rocket' ? 'orange' : 'white';
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
      ctx.fill();
    });

    // Draw mines
    minesPlaced.forEach(mine => {
      ctx.fillStyle = 'yellow';
      ctx.fillRect(mine.x, mine.y, 12, 12);
    });

    // Draw bombs (for future expansion)
    bombsPlaced.forEach(bomb => {
      ctx.fillStyle = 'magenta';
      ctx.beginPath();
      ctx.arc(bomb.x, bomb.y, 15, 0, Math.PI * 2);
      ctx.fill();
    });
  }

  // Place mine at mouse position
  function placeMine() {
    if (player.mines <= 0) return;
    player.mines--;
    minesPlaced.push({x: mouse.x - 6, y: mouse.y - 6, width: 12, height: 12});
    updateUI();
  }

  // Use bomb at mouse position (kills bots in radius)
  function useBomb() {
    if (player.bombs <= 0) return;
    player.bombs--;
    let radius = 100;
    bots = bots.filter(bot => {
      let dx = bot.x + bot.width/2 - mouse.x;
      let dy = bot.y + bot.height/2 - mouse.y;
      if (Math.sqrt(dx*dx + dy*dy) <= radius) {
        player.score++;
        localStorage.setItem('score', player.score);
        updateUI();
        return false; // remove bot
      }
      return true;
    });
    updateUI();
  }

  // Shop toggle
  shopToggle.addEventListener('click', () => {
    if (shop.style.display === 'none' || shop.style.display === '') {
      shop.style.display = 'block';
      shopToggle.textContent = 'Close Shop';
    } else {
      shop.style.display = 'none';
      shopToggle.textContent = 'Open Shop';
    }
  });

  // Shop buy buttons
  shopButtons.forEach(button => {
    button.addEventListener('click', () => {
      let item = button.dataset.item;
      buyItem(item);
    });
  });

  // Buy logic
  function buyItem(item) {
    switch (item) {
      case 'rocketLauncher':
        if (player.score >= 10 && player.rocketsAvailable === 0) {
          player.rocketsAvailable = 1;
          player.weapon = 'rocket';
          player.score -= 10;
        }
        break;
      case 'bomb':
        if (player.score >= 5) {
          player.bombs++;
          player.score -= 5;
        }
        break;
      case 'mine':
        if (player.score >= 5) {
          player.mines++;
          player.score -= 5;
        }
        break;
      case 'shield':
        if (player.score >= 15 && !player.shield) {
          player.shield = true;
          player.shieldHitsLeft = 10;
          player.score -= 15;
        }
        break;
    }
    updateUI();
  }

  // Keyboard input for movement
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;

    // Place mine with 'm'
    if (e.key.toLowerCase() === 'm') placeMine();
    // Use bomb with 'b'
    if (e.key.toLowerCase() === 'b') useBomb();
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  // Track mouse position on canvas
  canvas.addEventListener('mousemove', e => {
    let rect = canvas.getBoundingClientRect();
    mouse.x = e.clientX - rect.left;
    mouse.y = e.clientY - rect.top;
  });

  // Handle firing bullets on mouse hold
  canvas.addEventListener('mousedown', e => {
    if (!firingInterval) {
      shoot(); // immediate shot
      firingInterval = setInterval(shoot, 150);
    }
  });
  canvas.addEventListener('mouseup', e => {
    clearInterval(firingInterval);
    firingInterval = null;
  });

  // Game loop
  function gameLoop() {
    if (bots.length < MAX_BOTS) spawnBot();

    update();
    draw();

    updateUI();
    requestAnimationFrame(gameLoop);
  }

  // Start game
  updateUI();
  gameLoop();

})();
</script>

</body>
</html>
